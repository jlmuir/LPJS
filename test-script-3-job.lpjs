#!/bin/sh

#lpjs jobs 3
#lpjs cores-per-job 2
#lpjs min-cores-per-node all
#lpjs mem-per-core 1GiB

hostname
printenv | fgrep LPJS_
printf "Sleeping...\n"
sleep 5
printf "Done.\n"

# FIXME: Set this in dispatchd?
export LPJS_SUBMIT_HOST=moray.acadix.biz

# If this node has access to the working directory on moray, then
# the output files will already be there.  Otherwise, manually send
# the files there.  Create the file moray-shared-fs-marker in the
# working directory (the directory from which the job was submitted)
# on moray.  If that directory is shared with the compute node, then
# this script will see it, and won't need to scp the files there.
if [ ! -e moray-shared-fs-marker ]; then
    scp lpjs-job-* chaperone-*.stderr ${LPJS_SUBMIT_HOST}:$LPJS_WORKING_DIRECTORY
fi
